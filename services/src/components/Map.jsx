import { useEffect, useRef } from 'react';
import * as maptilersdk from '@maptiler/sdk';
import '@maptiler/sdk/dist/maptiler-sdk.css';

const SWEDEN_COORDS = {
    'halland': { lat: 56.89, lng: 12.80 },
    'bohuslän': { lat: 58.32, lng: 11.45 },
    'skåne': { lat: 55.99, lng: 13.59 },
    'stockholm': { lat: 59.33, lng: 18.07 },
    'göteborg': { lat: 57.71, lng: 11.97 },
    'malmö': { lat: 55.60, lng: 13.00 },
    'uppsala': { lat: 59.86, lng: 17.64 },
    'dalarna': { lat: 61.09, lng: 14.66 },
    'norrland': { lat: 65.58, lng: 19.50 },
    'gotland': { lat: 57.47, lng: 18.49 },
    'småland': { lat: 57.19, lng: 15.21 },
    'värmland': { lat: 59.73, lng: 13.23 },
    'västergötland': { lat: 58.25, lng: 13.05 },
    'östergötland': { lat: 58.41, lng: 15.62 },
    'södermanland': { lat: 59.03, lng: 16.75 },
    'närke': { lat: 59.10, lng: 15.00 },
    'västmanland': { lat: 59.62, lng: 16.55 },
    'uppland': { lat: 60.00, lng: 17.65 },
    'gästrikland': { lat: 60.67, lng: 17.00 },
    'hälsingland': { lat: 61.73, lng: 16.22 },
    'medelpad': { lat: 62.39, lng: 17.31 },
    'ångermanland': { lat: 63.28, lng: 17.99 },
    'jämtland': { lat: 63.17, lng: 14.64 },
    'västerbotten': { lat: 64.75, lng: 17.00 },
    'norrbotten': { lat: 66.83, lng: 20.20 },
    'lappland': { lat: 67.50, lng: 18.00 },
    'blekinge': { lat: 56.17, lng: 15.58 },
    'öland': { lat: 56.66, lng: 16.64 },
    'dalsland': { lat: 58.88, lng: 12.17 },

    'linköping': { lat: 58.41, lng: 15.62 },
    'norrköping': { lat: 58.59, lng: 16.18 },
    'västerås': { lat: 59.61, lng: 16.55 },
    'örebro': { lat: 59.27, lng: 15.21 },
    'helsingborg': { lat: 56.05, lng: 12.70 },
    'lund': { lat: 55.70, lng: 13.19 },
    'borås': { lat: 57.72, lng: 12.94 },
    'jönköping': { lat: 57.78, lng: 14.16 },
    'kalmar': { lat: 56.66, lng: 16.36 },
    'växjö': { lat: 56.88, lng: 14.81 },
    'karlstad': { lat: 59.38, lng: 13.50 },
    'sundsvall': { lat: 62.39, lng: 17.31 },
    'umeå': { lat: 63.83, lng: 20.26 },
    'luleå': { lat: 65.58, lng: 22.15 },
    'kiruna': { lat: 67.86, lng: 20.23 },
    'gävle': { lat: 60.67, lng: 17.14 },
    'falun': { lat: 60.61, lng: 15.63 },
    'visby': { lat: 57.64, lng: 18.29 },
    'trollhättan': { lat: 58.28, lng: 12.29 },
    'uddevalla': { lat: 58.35, lng: 11.93 },
    'skövde': { lat: 58.39, lng: 13.85 },
    'lidköping': { lat: 58.51, lng: 13.16 },
    'mariestad': { lat: 58.71, lng: 13.82 },
    'kristianstad': { lat: 56.03, lng: 14.15 },
    'ystad': { lat: 55.43, lng: 13.82 },
    'karlskrona': { lat: 56.16, lng: 15.58 },
    'halmstad': { lat: 56.67, lng: 12.86 },
    'varberg': { lat: 57.11, lng: 12.25 },
    'falkenberg': { lat: 56.90, lng: 12.49 },
    'hudiksvall': { lat: 61.73, lng: 17.10 },
    'bollnäs': { lat: 61.35, lng: 16.39 },
    'örnsköldsvik': { lat: 63.29, lng: 18.72 },
    'skellefteå': { lat: 64.75, lng: 20.95 },
    'piteå': { lat: 65.32, lng: 21.48 },
    'halland': { lat: 56.89, lng: 12.80 },
    'bohuslän': { lat: 58.32, lng: 11.45 },
    'skåne': { lat: 55.99, lng: 13.59 },
    'stockholm': { lat: 59.33, lng: 18.07 },
    'göteborg': { lat: 57.71, lng: 11.97 },
    'malmö': { lat: 55.60, lng: 13.00 },
    'uppsala': { lat: 59.86, lng: 17.64 },
    'dalarna': { lat: 61.09, lng: 14.66 },
    'norrland': { lat: 65.58, lng: 19.50 },
    'gotland': { lat: 57.47, lng: 18.49 },
    'småland': { lat: 57.19, lng: 15.21 },
    'värmland': { lat: 59.73, lng: 13.23 },
    'västergötland': { lat: 58.25, lng: 13.05 },
    'östergötland': { lat: 58.41, lng: 15.62 },
    'södermanland': { lat: 59.03, lng: 16.75 },
    'närke': { lat: 59.10, lng: 15.00 },
    'västmanland': { lat: 59.62, lng: 16.55 },
    'uppland': { lat: 60.00, lng: 17.65 },
    'gästrikland': { lat: 60.67, lng: 17.00 },
    'hälsingland': { lat: 61.73, lng: 16.22 },
    'medelpad': { lat: 62.39, lng: 17.31 },
    'ångermanland': { lat: 63.28, lng: 17.99 },
    'jämtland': { lat: 63.17, lng: 14.64 },
    'västerbotten': { lat: 64.75, lng: 17.00 },
    'norrbotten': { lat: 66.83, lng: 20.20 },
    'lappland': { lat: 67.50, lng: 18.00 },
    'blekinge': { lat: 56.17, lng: 15.58 },
    'öland': { lat: 56.66, lng: 16.64 },
    'dalsland': { lat: 58.88, lng: 12.17 },
    'västerås': { lat: 59.61, lng: 16.54 },
    'örebro': { lat: 59.27, lng: 15.21 },
    'linköping': { lat: 58.41, lng: 15.62 },
    'helsingborg': { lat: 56.04, lng: 12.69 },
    'jönköping': { lat: 57.78, lng: 14.16 },
    'norrköping': { lat: 58.59, lng: 16.18 },
    'lund': { lat: 55.70, lng: 13.19 },
    'umeå': { lat: 63.82, lng: 20.26 },
    'gävle': { lat: 60.67, lng: 17.14 },
    'borås': { lat: 57.72, lng: 12.94 },
    'eskilstuna': { lat: 59.37, lng: 16.51 },
    'halmstad': { lat: 56.67, lng: 12.86 },
    'växjö': { lat: 56.88, lng: 14.81 },
    'karlstad': { lat: 59.38, lng: 13.50 },
    'sundsvall': { lat: 62.39, lng: 17.31 },
    'östersund': { lat: 63.18, lng: 14.64 },
    'trollhättan': { lat: 58.28, lng: 12.29 },
    'luleå': { lat: 65.58, lng: 22.15 },
    'lidingö': { lat: 59.36, lng: 18.13 },
    'borlänge': { lat: 60.48, lng: 15.43 },
    'tumba': { lat: 59.20, lng: 17.83 },
    'kristianstad': { lat: 56.03, lng: 14.15 },
    'kalmar': { lat: 56.66, lng: 16.36 },
    'skellefteå': { lat: 64.75, lng: 20.95 },
    'skövde': { lat: 58.39, lng: 13.84 },
    'uddevalla': { lat: 58.35, lng: 11.94 },
    'motala': { lat: 58.54, lng: 15.04 },
    'karlskrona': { lat: 56.16, lng: 15.59 },
    'nyköping': { lat: 58.75, lng: 17.01 },
    'karlshamn': { lat: 56.17, lng: 14.86 },
    'varberg': { lat: 57.11, lng: 12.25 },
    'falun': { lat: 60.60, lng: 15.63 },
    'örnsköldsvik': { lat: 63.29, lng: 18.72 },
    'visby': { lat: 57.63, lng: 18.30 },
    'katrineholm': { lat: 59.00, lng: 16.21 },
    'ängelholm': { lat: 56.24, lng: 12.86 },
    'lidköping': { lat: 58.50, lng: 13.16 },
    'alingsås': { lat: 57.93, lng: 12.53 },
    'enköping': { lat: 59.64, lng: 17.08 },
    'västervik': { lat: 57.76, lng: 16.64 },
    'hässleholm': { lat: 56.16, lng: 13.77 },
    'piteå': { lat: 65.32, lng: 21.48 },
    'ystad': { lat: 55.43, lng: 13.82 },
    'eksjö': { lat: 57.67, lng: 14.97 },
    'kiruna': { lat: 67.85, lng: 20.22 },
    'hudiksvall': { lat: 61.73, lng: 17.11 },
    'nässjö': { lat: 57.65, lng: 14.69 },
    'mariestad': { lat: 58.71, lng: 13.82 },
    'köping': { lat: 59.51, lng: 15.99 },
    'boden': { lat: 65.82, lng: 21.69 },
    'arvika': { lat: 59.66, lng: 12.59 },
    'ludvika': { lat: 60.15, lng: 15.19 },
    'sala': { lat: 59.92, lng: 16.61 },
    'mora': { lat: 61.01, lng: 14.54 },
    'härnösand': { lat: 62.63, lng: 17.94 },
    'söderhamn': { lat: 61.30, lng: 17.05 },
    'åmål': { lat: 59.05, lng: 12.70 },
    'lycksele': { lat: 64.59, lng: 18.67 },
    'säffle': { lat: 59.13, lng: 12.92 },
    'sollefteå': { lat: 63.17, lng: 17.27 },
    'falkenberg': { lat: 56.90, lng: 12.49 },
    'laholm': { lat: 56.51, lng: 13.04 },
    'vetlanda': { lat: 57.43, lng: 15.08 },
    'tranås': { lat: 58.04, lng: 14.98 },
    'oskarshamn': { lat: 57.26, lng: 16.45 },
    'ronneby': { lat: 56.21, lng: 15.28 },
    'sölvesborg': { lat: 56.05, lng: 14.59 },
    'simrishamn': { lat: 55.55, lng: 14.35 },
    'kristinehamn': { lat: 59.31, lng: 14.11 },
    'filipstad': { lat: 59.71, lng: 14.17 },
    'strängnäs': { lat: 59.37, lng: 17.03 },
    'trosa': { lat: 58.90, lng: 17.55 },
    'arboga': { lat: 59.39, lng: 15.84 },
    'fagersta': { lat: 59.99, lng: 15.79 },
    'hedemora': { lat: 60.28, lng: 15.98 },
    'säter': { lat: 60.35, lng: 15.75 },
    'avesta': { lat: 60.14, lng: 16.17 },
    'sandviken': { lat: 60.62, lng: 16.77 },
    'bollnäs': { lat: 61.35, lng: 16.39 },
    'ljusdal': { lat: 61.83, lng: 16.09 },
    'haparanda': { lat: 65.83, lng: 24.13 },
    'skänninge': { lat: 58.39, lng: 15.08 },
    'vadstena': { lat: 58.45, lng: 14.89 },
    'skara': { lat: 58.38, lng: 13.43 },
    'tidaholm': { lat: 58.18, lng: 13.96 },
    'falköping': { lat: 58.17, lng: 13.55 },
    'hjo': { lat: 58.30, lng: 14.29 },
    'ulricehamn': { lat: 57.79, lng: 13.41 },
    'borgholm': { lat: 56.88, lng: 16.65 },
    'söderköping': { lat: 58.48, lng: 16.32 },
    'södertälje': { lat: 59.19, lng: 17.62 },
    'kungälv': { lat: 57.87, lng: 11.98 },
    'marstrand': { lat: 57.88, lng: 11.58 },
    'lysekil': { lat: 58.27, lng: 11.43 },
    'strömstad': { lat: 58.94, lng: 11.17 },
    'gränna': { lat: 58.02, lng: 14.46 },
    'vimmerby': { lat: 57.66, lng: 15.85 },
    'sundbyberg': { lat: 59.36, lng: 17.97 },
    'solna': { lat: 59.36, lng: 18.00 },
    'nacka': { lat: 59.31, lng: 18.16 },
    'huddinge': { lat: 59.24, lng: 17.98 },
    'botkyrka': { lat: 59.20, lng: 17.83 },
    'tyresö': { lat: 59.24, lng: 18.23 },
    'haninge': { lat: 59.17, lng: 18.14 },
    'järfälla': { lat: 59.44, lng: 17.84 },
    'täby': { lat: 59.44, lng: 18.07 },
    'sollentuna': { lat: 59.43, lng: 17.95 },
    'upplands väsby': { lat: 59.52, lng: 17.91 },
    'vallentuna': { lat: 59.53, lng: 18.08 },
    'åkersberga': { lat: 59.48, lng: 18.30 },
    'märsta': { lat: 59.62, lng: 17.85 },
    'sigtuna': { lat: 59.61, lng: 17.72 },
    'norrtälje': { lat: 59.76, lng: 18.70 },
    'nykvarn': { lat: 59.18, lng: 17.43 },
    'oxelösund': { lat: 58.67, lng: 17.11 },
    'flen': { lat: 59.05, lng: 16.58 },
    'gnesta': { lat: 59.04, lng: 17.31 },
    'mjölby': { lat: 58.32, lng: 15.12 },
    'åtvidaberg': { lat: 58.20, lng: 15.99 },
    'finspång': { lat: 58.71, lng: 15.77 },
    'valdemarsvik': { lat: 58.20, lng: 16.60 },
    'aneby': { lat: 57.84, lng: 14.81 },
    'habo': { lat: 57.91, lng: 14.07 },
    'mullsjö': { lat: 57.92, lng: 13.88 },
    'gnosjö': { lat: 57.36, lng: 13.73 },
    'värnamo': { lat: 57.18, lng: 14.04 },
    'gislaved': { lat: 57.30, lng: 13.54 },
    'vaggeryd': { lat: 57.50, lng: 14.15 },
    'sävsjö': { lat: 57.40, lng: 14.66 },
    'ljungby': { lat: 56.83, lng: 13.94 },
    'alvesta': { lat: 56.90, lng: 14.55 },
    'älmhult': { lat: 56.55, lng: 14.13 },
    'tingsryd': { lat: 56.53, lng: 14.97 },
    'lessebo': { lat: 56.75, lng: 15.26 },
    'uppvidinge': { lat: 57.17, lng: 15.34 },
    'nybro': { lat: 56.74, lng: 15.91 },
    'hultsfred': { lat: 57.49, lng: 15.84 },
    'högsby': { lat: 57.16, lng: 16.02 },
    'mönsterås': { lat: 57.04, lng: 16.44 },
    'emmaboda': { lat: 56.63, lng: 15.54 },
    'torsås': { lat: 56.41, lng: 16.00 },
    'mörbylånga': { lat: 56.52, lng: 16.39 },
    'färjestaden': { lat: 56.65, lng: 16.47 },
    'olofström': { lat: 56.27, lng: 14.53 },
    'bromölla': { lat: 56.07, lng: 14.47 },
    'osby': { lat: 56.38, lng: 13.99 },
    'perstorp': { lat: 56.13, lng: 13.39 },
    'klippan': { lat: 56.13, lng: 13.13 },
    'örkelljunga': { lat: 56.28, lng: 13.27 },
    'båstad': { lat: 56.43, lng: 12.84 },
    'höganäs': { lat: 56.20, lng: 12.55 },
    'bjuv': { lat: 56.08, lng: 12.91 },
    'åstorp': { lat: 56.13, lng: 12.94 },
    'landskrona': { lat: 55.87, lng: 12.83 },
    'eslöv': { lat: 55.83, lng: 13.30 },
    'höör': { lat: 55.93, lng: 13.54 },
    'hörby': { lat: 55.85, lng: 13.66 },
    'sjöbo': { lat: 55.63, lng: 13.70 },
    'tomelilla': { lat: 55.54, lng: 13.95 },
    'skurup': { lat: 55.48, lng: 13.50 },
    'svedala': { lat: 55.50, lng: 13.23 },
    'vellinge': { lat: 55.47, lng: 12.98 },
    'trelleborg': { lat: 55.37, lng: 13.15 },
    'staffanstorp': { lat: 55.64, lng: 13.20 },
    'lomma': { lat: 55.67, lng: 13.07 },
    'kävlinge': { lat: 55.79, lng: 13.11 },
    'kungsbacka': { lat: 57.48, lng: 12.07 },
    'hyltebruk': { lat: 56.99, lng: 13.24 },
    'partille': { lat: 57.73, lng: 12.10 },
    'mölndal': { lat: 57.65, lng: 12.01 },
    'härryda': { lat: 57.67, lng: 12.35 },
    'lerum': { lat: 57.77, lng: 12.27 },
    'ale': { lat: 57.92, lng: 12.08 },
    'lilla edet': { lat: 58.13, lng: 12.12 },
    'stenungsund': { lat: 58.07, lng: 11.81 },
    'tjörn': { lat: 58.00, lng: 11.63 },
    'orust': { lat: 58.21, lng: 11.70 },
    'munkedal': { lat: 58.47, lng: 11.68 },
    'tanum': { lat: 58.72, lng: 11.32 },
    'bengtsfors': { lat: 59.03, lng: 12.22 },
    'mellerud': { lat: 58.70, lng: 12.45 },
    'färgelanda': { lat: 58.57, lng: 12.01 },
    'vänersborg': { lat: 58.38, lng: 12.32 },
    'vårgårda': { lat: 58.03, lng: 12.81 },
    'herrljunga': { lat: 58.07, lng: 13.02 },
    'tranemo': { lat: 57.48, lng: 13.35 },
    'svenljunga': { lat: 57.49, lng: 13.11 },
    'mark': { lat: 57.51, lng: 12.68 },
    'bollebygd': { lat: 57.72, lng: 12.57 },
    'tibro': { lat: 58.42, lng: 14.16 },
    'töreboda': { lat: 58.70, lng: 14.12 },
    'essunga': { lat: 58.17, lng: 12.71 },
    'gullspång': { lat: 58.98, lng: 14.10 },
    'karlsborg': { lat: 58.53, lng: 14.51 },
    'vara': { lat: 58.26, lng: 12.95 },
    'götene': { lat: 58.52, lng: 13.48 },
    'nossebro': { lat: 58.18, lng: 12.72 },
    'grästorp': { lat: 58.33, lng: 12.67 },
    'hammarö': { lat: 59.33, lng: 13.52 },
    'forshaga': { lat: 59.52, lng: 13.47 },
    'kil': { lat: 59.50, lng: 13.31 },
    'grums': { lat: 59.35, lng: 13.11 },
    'årjäng': { lat: 59.39, lng: 12.13 },
    'sunne': { lat: 59.83, lng: 13.14 },
    'torsby': { lat: 60.13, lng: 13.00 },
    'hagfors': { lat: 60.03, lng: 13.69 },
    'munkfors': { lat: 59.83, lng: 13.54 },
    'storfors': { lat: 59.53, lng: 14.27 },
    'degerfors': { lat: 59.23, lng: 14.43 },
    'kumla': { lat: 59.12, lng: 15.14 },
    'hallsberg': { lat: 59.06, lng: 15.11 },
    'askersund': { lat: 58.88, lng: 14.90 },
    'laxå': { lat: 58.98, lng: 14.61 },
    'lekeberg': { lat: 59.16, lng: 14.87 },
    'lindesberg': { lat: 59.59, lng: 15.22 },
    'nora': { lat: 59.51, lng: 15.04 },
    'hällefors': { lat: 59.85, lng: 14.52 },
    'ljusnarsberg': { lat: 59.87, lng: 14.99 },
    'hallstahammar': { lat: 59.61, lng: 16.22 },
    'surahammar': { lat: 59.70, lng: 16.21 },
    'kungsör': { lat: 59.42, lng: 16.09 },
    'skinnskatteberg': { lat: 59.82, lng: 15.68 },
    'norberg': { lat: 60.06, lng: 15.91 },
    'tierp': { lat: 60.34, lng: 17.51 },
    'östhammar': { lat: 60.25, lng: 18.37 },
    'heby': { lat: 59.93, lng: 16.85 },
    'knivsta': { lat: 59.72, lng: 17.78 },
    'håbo': { lat: 59.56, lng: 17.52 },
    'älvkarleby': { lat: 60.57, lng: 17.45 },
    'leksand': { lat: 60.73, lng: 14.99 },
    'rättvik': { lat: 60.88, lng: 15.11 },
    'orsa': { lat: 61.12, lng: 14.61 },
    'vansbro': { lat: 60.51, lng: 14.22 },
    'malung': { lat: 60.68, lng: 13.71 },
    'gagnef': { lat: 60.59, lng: 15.13 },
    'smedjebacken': { lat: 60.14, lng: 15.41 },
    'hofors': { lat: 60.54, lng: 16.28 },
    'ockelbo': { lat: 60.89, lng: 16.71 },
    'nordanstig': { lat: 61.98, lng: 17.07 },
    'åre': { lat: 63.40, lng: 13.08 },
    'krokom': { lat: 63.32, lng: 14.45 },
    'strömsund': { lat: 63.85, lng: 15.55 },
    'bräcke': { lat: 62.75, lng: 15.42 },
    'berg': { lat: 62.78, lng: 14.45 },
    'härjedalen': { lat: 62.10, lng: 14.25 },
    'ragunda': { lat: 63.11, lng: 16.35 },
    'timrå': { lat: 62.48, lng: 17.32 },
    'ånge': { lat: 62.52, lng: 15.65 },
    'kramfors': { lat: 62.93, lng: 17.77 },
    'robertsfors': { lat: 64.19, lng: 20.84 },
    'vindeln': { lat: 64.19, lng: 19.71 },
    'vännäs': { lat: 63.90, lng: 19.75 },
    'nordmaling': { lat: 63.56, lng: 19.50 },
    'bjurholm': { lat: 63.93, lng: 19.21 },
    'vilhelmina': { lat: 64.62, lng: 16.65 },
    'dorotea': { lat: 64.26, lng: 16.41 },
    'åsele': { lat: 64.16, lng: 17.35 },
    'storuman': { lat: 65.09, lng: 17.11 },
    'sorsele': { lat: 65.53, lng: 17.53 },
    'malå': { lat: 65.18, lng: 18.74 },
    'norsjö': { lat: 64.91, lng: 19.47 },
    'älvsbyn': { lat: 65.67, lng: 21.01 },
    'arvidsjaur': { lat: 65.59, lng: 19.17 },
    'arjeplog': { lat: 66.05, lng: 17.88 },
    'jokkmokk': { lat: 66.60, lng: 19.83 },
    'gällivare': { lat: 67.13, lng: 20.65 },
    'pajala': { lat: 67.21, lng: 23.36 },
    'överkalix': { lat: 66.32, lng: 22.84 },
    'övertorneå': { lat: 66.38, lng: 23.65 },
    'kalix': { lat: 65.85, lng: 23.14 }
};



function getCoords(area, index) {
    const key = area ? area.toLowerCase() : 'sverige';
    const base = SWEDEN_COORDS[key] || { lat: 62, lng: 15 };
    
    // Slumpmässig spridning baserat på index
    const spread = 0.3;
    const offsetLat = (Math.sin(index * 2.5) * spread);
    const offsetLng = (Math.cos(index * 3.7) * spread);
    
    return {
        lat: base.lat + offsetLat,
        lng: base.lng + offsetLng
    };
}

export default function MapView({ events, onEventClick }) {
    const mapContainer = useRef(null);

    useEffect(() => {
        maptilersdk.config.apiKey = 'kNPyqqEDajTwuaZTofx9';

        const map = new maptilersdk.Map({
            container: mapContainer.current,
            style: maptilersdk.MapStyle.HYBRID,
            center: [16, 62],
            zoom: 3,
            projection: 'globe'
        });

        map.on('load', () => {
            events.forEach((event, index) => {
                const coords = getCoords(event.area, index);

                const marker = document.createElement('div');
                marker.style.width = '15px';
                marker.style.height = '15px';
                marker.style.backgroundColor = '#ff4444';
                marker.style.borderRadius = '50%';
                marker.style.cursor = 'pointer';
                marker.style.border = '2px solid white';

                marker.addEventListener('click', () => onEventClick(event));

                new maptilersdk.Marker({ element: marker })
                    .setLngLat([coords.lng, coords.lat])
                    .addTo(map);
            });
        });

        return () => map.remove();
    }, [events]);

    return <div ref={mapContainer} style={{ width: '100%', height: '100vh' }} />;
}